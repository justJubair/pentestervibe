import { FC, useEffect, useRef, useState } from 'react';
import { HiOutlineArrowNarrowRight } from 'react-icons/hi';
import { Link } from 'react-router-dom';
import './homepage.css';
import { CountUp } from 'use-count-up';


const SecondSection: FC = () => {
	const [counterOn, setCounterOn] = useState<boolean>(false);
	const cardsRef = useRef<HTMLDivElement>(null);
	const enrollSectionRef = useRef<HTMLDivElement>(null);

	// handle side effect for handle mouse move
	useEffect(() => {
		const handleMouseMove = (e: MouseEvent) => {
			if (cardsRef.current) {
				for (const card of cardsRef.current.getElementsByClassName("card")) {
					const rect = card.getBoundingClientRect(),
						x = e.clientX - rect.left,
						y = e.clientY - rect.top;

					(card as HTMLElement).style.setProperty("--mouse-x", `${x}px`);
					(card as HTMLElement).style.setProperty("--mouse-y", `${y}px`);
				}
			}
		};

		if (cardsRef.current) {
			cardsRef.current.addEventListener("mousemove", handleMouseMove);
		}

		return () => {
			if (cardsRef.current) {
				cardsRef.current.removeEventListener("mousemove", handleMouseMove);
			}
		};
	}, []);

	// handle side effect for countup section in viewport
	useEffect(() => {
		const observer = new IntersectionObserver(
			([entry]) => {
				// Check if the "CountUp" section is in the viewport
				if (entry.isIntersecting) {
					setCounterOn(true);
				} else {
					setCounterOn(false);
				}
			},
			{
				root: null,
				rootMargin: '0px',
				threshold: 0.1,
			}
		);

		if (enrollSectionRef.current) {
			observer.observe(enrollSectionRef.current);
		}

		return () => {
			if (enrollSectionRef.current) {
				observer.unobserve(enrollSectionRef.current);
			}
		};
	}, []);

	return (
		<section className='relative w-full wrapper'>
			<h1 className='w-full flex justify-center h-10'>
				<img
					src='/svg/shapes/home-page/header-get.svg'
					alt='second-section-header'
				/>
			</h1>

			{/* for larger devices start */}
			<div className='w-full grid-cols-1 md:grid-cols-2 mt-10 grid' ref={cardsRef}>
				<div className='relative second-section-shape bg-glass -left-7 scale-[.83] backdrop-blur-md hidden lg:flex flex-col items-center justify-center overflow-hidden'>
					<svg viewBox='0 0 10 10' className='w-full h-full lg:hidden'>
						<path
							d='M 1.5 0.5 Q 6 1 10.5 0.5 Q 11.5 0.5 11.5 1.5 Q 11 5 11.5 8.5 Q 11.5 9.5 10.5 9.5 Q 6 9 1.5 9.5 Q 0.5 9.5 0.5 8.5 Q 1 5 0.5 1.5 Q 0.5 0.5 1.5 0.5 z'
							fill='rgba(255, 255, 255, 0.07)'
							strokeWidth='0.2'
							stroke='none'
						/>
					</svg>
					<div className='absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center p-10 md:p-16 card scale-110'>
						<div className='flex flex-row md:flex-col items-center justify-center'>
							<img
								src='/svg/shapes/home-page/get-1.svg'
								alt='Professional Guideline shape'
								className='w-1/2 md:w-auto'
							/>

							<h2 className='text-xl scale-125 md:text-2xl font-bold md:mt-5'>
								<span className='text-white'>Professional</span>{' '}
								<span className='text-secondary'>Guideline</span>
							</h2>
						</div>

						<p className='text-gray-400 text-sm text-center md:mt-4 scale-125'>
							We are providing professional guideline from professional <br />  mentor.
							One step guideline for all learners
						</p>

						<Link to='/#' className='md:mt-5 text-white font-medium underline text-sm scale-125'>
							See The Guideline
						</Link>
					</div>
				</div>
				<div className='relative second-section-shape bg-glass -left-11 scale-[.83] backdrop-blur-md  hidden lg:flex card flex-col items-center justify-center'>
					<svg viewBox='0 0 12 10' className='w-full h-full lg:hidden'>
						<path
							d='M 1.5 0.5 Q 6 1 10.5 0.5 Q 11.5 0.5 11.5 1.5 Q 11 5 11.5 8.5 Q 11.5 9.5 10.5 9.5 Q 6 9 1.5 9.5 Q 0.5 9.5 0.5 8.5 Q 1 5 0.5 1.5 Q 0.5 0.5 1.5 0.5 z'
							fill='rgba(255, 255, 255, 0.07)'
							strokeWidth='0.2'
							stroke='none'
						/>
					</svg>
					<div className='absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center p-16 scale-110'>
						<div className='flex flex-row md:flex-col items-center justify-center'>

							<img
								src='/svg/shapes/home-page/get-2.svg'
								alt='Professional Guideline shape'
								className='w-1/2'
							/>

							<h2 className='text-xl scale-125 md:text-2xl font-bold md:mt-5'>
								<span className='text-white'>Real Life</span>{' '}
								<span className='text-secondary'>Experience</span>
							</h2>
						</div>

						<p className='text-gray-400 text-sm text-center md:mt-4 scale-125'>
							We are providing professional guideline from professional <br /> mentor.
							One step guideline for all learners
						</p>

						<Link to='/#' className='md:mt-5 text-white font-medium underline text-sm scale-125'>
							See The Guideline
						</Link>
					</div>
				</div>
			</div>
			{/* for larger devices end */}

			{/* for smaller devices */}
			<div className='w-full grid grid-cols-1 md:grid-cols-2 mt-10 lg:hidden'>
				<div className='relative backdrop-blur-md  flex flex-col items-center justify-center overflow-hidden'>
					<svg viewBox='0 0 12 10' className='w-full h-full'>
						<path
							d='M 1.5 0.5 Q 6 1 10.5 0.5 Q 11.5 0.5 11.5 1.5 Q 11 5 11.5 8.5 Q 11.5 9.5 10.5 9.5 Q 6 9 1.5 9.5 Q 0.5 9.5 0.5 8.5 Q 1 5 0.5 1.5 Q 0.5 0.5 1.5 0.5 z'
							fill='rgba(255, 255, 255, 0.07)'
							strokeWidth='0.2'
							stroke='none'
						/>
					</svg>

					<div className='absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center p-10 md:p-16 card'>
						<div className='flex flex-row md:flex-col items-center justify-center'>
							<img
								src='/svg/shapes/home-page/get-1.svg'
								alt='Professional Guideline shape'
								className='w-1/2 md:w-auto'
							/>

							<h2 className='text-xl md:text-2xl font-bold md:mt-5'>
								<span className='text-white'>Professional</span>{' '}
								<span className='text-secondary'>Guideline</span>
							</h2>
						</div>

						<p className='text-gray-400 text-sm text-center md:mt-4'>
							We are providing professional guideline from professional mentor.
							One step guideline for all learners
						</p>

						<Link to='/#' className='md:mt-5 text-white font-medium underline text-sm'>
							See The Guideline
						</Link>
					</div>
				</div>

				<div className='relative backdrop-blur-md card flex flex-col items-center justify-center'>
					<svg viewBox='0 0 12 10' className='w-full h-full'>
						<path
							d='M 1.5 0.5 Q 6 1 10.5 0.5 Q 11.5 0.5 11.5 1.5 Q 11 5 11.5 8.5 Q 11.5 9.5 10.5 9.5 Q 6 9 1.5 9.5 Q 0.5 9.5 0.5 8.5 Q 1 5 0.5 1.5 Q 0.5 0.5 1.5 0.5 z'
							fill='rgba(255, 255, 255, 0.07)'
							strokeWidth='0.2'
							stroke='none'
						/>
					</svg>

					<div className='absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center p-16'>

						<div className='flex flex-row md:flex-col items-center justify-center'>

							<img
								src='/svg/shapes/home-page/get-2.svg'
								alt='Professional Guideline shape'
								className='w-1/2'
							/>

							<h2 className='text-xl md:text-2xl font-bold md:mt-5'>
								<span className='text-white'>Real Life</span>{' '}
								<span className='text-secondary'>Experience</span>
							</h2>
						</div>

						<p className='text-gray-400 text-sm text-center md:mt-4'>
							We are providing professional guideline from professional mentor.
							One step guideline for all learners
						</p>

						<Link to='/#' className='md:mt-5 text-white font-medium underline text-sm'>
							See The Guideline
						</Link>
					</div>
				</div>
			</div>
			{/* for smaller devices end */}

			<div className='mt-10 px-7'>
				<div
					style={{ background: 'rgba(255, 255, 255, 0.07)' }}
					className='backdrop-blur-md flex items-center justify-between px-3 py-3 md:px-20 md:py-10 rounded-2xl flex-col md:flex-row'
				>
					<div ref={enrollSectionRef} className='flex flex-col md:flex-row items-center gap-0 md:gap-5 font-inter'>
						<h3 className='bg-gradient-to-r from-[#b849dc] to-secondary text-transparent bg-clip-text font-bold text-4xl md:text-6xl'>
							{
								counterOn ? <CountUp start={999} isCounting={true} end={1243} duration={1} easing={'linear'} /> : 999
							}
							+
						</h3>
						<p className='text-gray-400 text-xl mb-1'>Students are Enrolled</p>
					</div>

					<button className='flex items-center gap-3 text-white bg-gradient-to-r from-[#DA84DD] to-[#A949CF] px-3 py-2 md:px-8 md:py-4 rounded-lg font-semibold shadow-lg shadow-[#DA84DD]/20 hover:shadow-[#DA84DD]/30 transition duration-300 ease-in-out'>
						<span>Join With Us</span>
						<HiOutlineArrowNarrowRight className='text-2xl -mb-0.5' />
					</button>
				</div>
			</div>
		</section>
	);
};

export default SecondSection;
