import React, { FC, FormEvent, useRef } from 'react';
import { RxCross1 } from 'react-icons/rx';
import emailjs from "@emailjs/browser";
import Swal from 'sweetalert2'

type GetReadyModalProps = {
    isModalOpen: boolean;
    setIsModalOpen: React.Dispatch<React.SetStateAction<boolean>>;
}

const NotifyMeModal: FC<GetReadyModalProps> = ({ isModalOpen, setIsModalOpen }) => {
    const form = useRef<HTMLFormElement>(null);


    const sendEmail = (e: FormEvent<HTMLFormElement>) => {
        e.preventDefault();
        emailjs
            .sendForm(
                import.meta.env.VITE_EMAILJS_SERVICE_ID,
                import.meta.env.VITE_EMAILJS_TEMPLATE_ID,
                form.current || "",
                import.meta.env.VITE_EMAILJS_PUBLIC_KEY
            )
            .then(
                (result) => {
                    if (result.status === 200) {
                        Swal.fire({
                            position: "center",
                            icon: "success",
                            title: "Your message has been successfully sent!",
                            showConfirmButton: true,
                            timer: 1500
                        });
                        setIsModalOpen(false)
                    }
                },
                (error) => {
                    Swal.fire({
                        position: "top-end",
                        icon: "error",
                        title: "Something Went Wrong" || error,
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            );
    };

    return (
        isModalOpen &&
        <div className='fixed h-full w-full top-0 right-0 bg-[#050110]/80 flex items-center justify-center z-10'>
            <div className='bg-accent py-10 px-7 max-w-2xl w-full backdrop-blur-md rounded-[32px] relative'>
                <button onClick={() => setIsModalOpen(false)} className='absolute top-4 right-4'> <RxCross1 className="h-8 w-8 bg-accent rounded-full p-1 border border-glass z-50" /></button>
                <h5 className='text-3xl font-bold'>Notify Me</h5>
                <form ref={form} onSubmit={sendEmail}>
                    <div className='space-y-5'>
                        <div className='flex justify-between gap-6 my-8'>
                            <div className='w-full'>
                                <span className='text-base font-bold text-white/70'>Email</span>
                                <input
                                    type='email'
                                    name='email'
                                    required
                                    id='email'
                                    className='bg-[#4740583B] outline-none rounded-md  font-bold text-lg py-3 px-4 backdrop-blur-md w-full my-2'
                                    placeholder='Enter Your Email'
                                />
                            </div>

                        </div>
                    </div>
                    <div className='w-full text-center mt-6'>
                        <button type='submit' className='primary-btn-col w-2/5 mx-auto rounded-[16px] py-3 px-7'>Send</button>
                    </div>
                </form>
            </div>
        </div>
    );
};

export default NotifyMeModal;